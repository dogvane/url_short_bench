@echo off
echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                    DbRepository æ€§èƒ½æµ‹è¯•å·¥å…·                          â•‘
echo â•‘                         æ¼”ç¤º & å¿«é€Ÿæµ‹è¯•                               â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

cd /d "%~dp0"

echo [1/4] æ£€æŸ¥æž„å»ºçŽ¯å¢ƒ...
dotnet --version >nul 2>&1
if %errorlevel% neq 0 (
    echo âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ° .NET SDK
    echo è¯·å®‰è£… .NET 9.0 æˆ–æ›´é«˜ç‰ˆæœ¬
    pause
    exit /b 1
)
echo     âœ“ .NET SDK å·²å®‰è£…

echo.
echo [2/4] æž„å»ºæ€§èƒ½æµ‹è¯•é¡¹ç›®...
dotnet build --configuration Release --verbosity quiet --no-restore
if %errorlevel% neq 0 (
    echo âŒ é”™è¯¯ï¼šæž„å»ºå¤±è´¥
    echo.
    echo è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š
    dotnet build --configuration Release
    pause
    exit /b 1
)
echo     âœ“ æž„å»ºæˆåŠŸ

echo.
echo [3/4] å¼€å§‹æ€§èƒ½æµ‹è¯•...
echo     ðŸ“Š æµ‹è¯•å†…å®¹ï¼š
echo        â€¢ å•æ¬¡åˆ›å»ºæ“ä½œï¼ˆåŸºå‡†æµ‹è¯•ï¼‰
echo        â€¢ å•æ¬¡æŸ¥è¯¢æ“ä½œ
echo        â€¢ æ‰¹é‡åˆ›å»º10ä¸ªçŸ­é“¾æŽ¥
echo        â€¢ æ‰¹é‡æŸ¥è¯¢10ä¸ªçŸ­é“¾æŽ¥
echo.
echo     â±ï¸  é¢„è®¡è¿è¡Œæ—¶é—´ï¼š1-3åˆ†é’Ÿ
echo     ðŸ’¡ è¯·è€å¿ƒç­‰å¾…ï¼ŒBenchmarkDotNet éœ€è¦å¤šæ¬¡è¿è¡Œä»¥èŽ·å¾—å‡†ç¡®ç»“æžœ
echo.

echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
dotnet run --configuration Release --no-build -- QuickDbRepositoryBenchmark
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo.
echo [4/4] æµ‹è¯•å®Œæˆåˆ†æž
if %errorlevel% equ 0 (
    echo     âœ“ æ€§èƒ½æµ‹è¯•æ‰§è¡ŒæˆåŠŸï¼
    echo.
    echo ðŸ“ˆ å¦‚ä½•è§£è¯»ç»“æžœï¼š
    echo    â€¢ Meanï¼šå¹³å‡æ‰§è¡Œæ—¶é—´ï¼ˆæ•°å€¼è¶Šå°è¶Šå¥½ï¼‰
    echo    â€¢ Allocatedï¼šå†…å­˜åˆ†é…é‡ï¼ˆæ•°å€¼è¶Šå°è¶Šå¥½ï¼‰
    echo    â€¢ Ratioï¼šç›¸å¯¹äºŽåŸºå‡†çš„å€æ•°ï¼ˆCreateSingleShortLink = 1.00ï¼‰
    echo.
    echo ðŸ“ è¯¦ç»†æŠ¥å‘Šä½ç½®ï¼š
    echo    BenchmarkDotNet.Artifacts\results\
    echo.
    echo ðŸš€ ä¸‹ä¸€æ­¥ï¼š
    echo    â€¢ è¿è¡Œ run_benchmark.bat è¿›è¡Œå®Œæ•´æµ‹è¯•
    echo    â€¢ æŸ¥çœ‹ README.md äº†è§£æ›´å¤šç”¨æ³•
) else (
    echo âŒ æµ‹è¯•æ‰§è¡Œå¤±è´¥
    echo è¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯æˆ–è”ç³»å¼€å‘è€…
)

echo.
echo æŒ‰ä»»æ„é”®é€€å‡º...
pause >nul
